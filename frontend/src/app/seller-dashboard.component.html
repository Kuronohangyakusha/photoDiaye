<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-left">
      <h1>üè™ Mon Espace Vendeur</h1>
      <p>G√©rez vos articles et votre boutique</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="goHome()">üè† Accueil</button>
      <button class="btn btn-outline" (click)="logout()">üö™ D√©connexion</button>
    </div>
  </header>

  <div class="dashboard-content">
    <!-- Section Actions -->
    <div class="actions-section">
      <button
        class="btn btn-primary create-btn"
        (click)="toggleCreateForm()"
      >
        <span *ngIf="!showCreateForm">‚ûï Cr√©er un article</span>
        <span *ngIf="showCreateForm">‚úñ Fermer</span>
      </button>
    </div>

    <!-- Formulaire de cr√©ation/modification d'article -->
    <div *ngIf="showCreateForm || showEditForm" class="create-form-card">
      <h3>{{ showEditForm ? '‚úèÔ∏è Modifier l\'article' : 'üìù Cr√©er un nouvel article' }}</h3>
      <form (ngSubmit)="onSubmitArticle()" class="article-form">
        <div class="form-row">
          <div class="form-group">
            <label for="titre">Titre *</label>
            <input
              id="titre"
              type="text"
              [(ngModel)]="newArticle.titre"
              name="titre"
              placeholder="Titre de l'article"
              required
              class="form-input"
            >
          </div>
          <div class="form-group">
            <label for="categorie">Cat√©gorie</label>
            <select
              id="categorie"
              [(ngModel)]="newArticle.categorie"
              name="categorie"
              class="form-input"
            >
              <option value="">S√©lectionner une cat√©gorie</option>
              <option value="√âlectronique">√âlectronique</option>
              <option value="V√©hicules">V√©hicules</option>
              <option value="Immobilier">Immobilier</option>
              <option value="V√™tements">V√™tements</option>
              <option value="Maison">Maison</option>
              <option value="Loisirs">Loisirs</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea
            id="description"
            [(ngModel)]="newArticle.description"
            name="description"
            placeholder="Description d√©taill√©e de l'article"
            rows="3"
            class="form-input"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="prix">Prix (FCFA) *</label>
            <input
              id="prix"
              type="number"
              [(ngModel)]="newArticle.prix"
              name="prix"
              placeholder="0"
              min="0"
              required
              class="form-input"
            >
          </div>
          <div class="form-group">
            <label>Photo de l'article *</label>
            <div class="image-upload-section">
              <div class="image-preview" *ngIf="selectedImagePreview">
                <img [src]="selectedImagePreview" alt="Aper√ßu">
              </div>
              <div class="upload-buttons">
                <button
                  type="button"
                  (click)="openCamera()"
                  class="btn btn-camera"
                  title="Photographiez directement le produit"
                >
                  üì∑ Photographier le produit
                </button>
              </div>
              <small class="form-hint">
                Photographiez ou capturez directement le produit ‚Ä¢ Max: 5MB ‚Ä¢ Photo obligatoire
              </small>
            </div>
          </div>
        </div>

        <div class="error-message" *ngIf="errorMessage">
          {{ errorMessage }}
        </div>

        <div class="success-message" *ngIf="successMessage">
          {{ successMessage }}
        </div>

        <div class="form-actions">
          <button
            type="button"
            (click)="showEditForm ? cancelEdit() : toggleCreateForm()"
            class="btn btn-secondary"
          >
            Annuler
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="isLoading"
          >
            <span *ngIf="isLoading">{{ showEditForm ? '‚è≥ Modification...' : '‚è≥ Cr√©ation...' }}</span>
            <span *ngIf="!isLoading">{{ showEditForm ? '‚úÖ Modifier l\'article' : '‚úÖ Cr√©er l\'article' }}</span>
          </button>
        </div>
      </form>
    </div>

    <!-- Liste des articles -->
    <div class="articles-section">
      <h3>üì¶ Mes Articles ({{ userArticles.length }})</h3>

      <div *ngIf="userArticles.length === 0" class="no-articles">
        <p>Vous n'avez pas encore d'articles. Cr√©ez votre premier article !</p>
      </div>

      <div *ngIf="filteredArticles.length > 0" class="articles-grid">
        <div *ngFor="let article of paginatedArticles" class="article-card">
          <div class="article-image">
            <img [src]="article.urlImage" [alt]="article.titre" loading="lazy">
          </div>
          <div class="article-content">
            <h4 class="article-title">{{ article.titre }}</h4>
            <p class="article-description" *ngIf="article.description">{{ article.description }}</p>
            <div class="article-meta">
              <span class="article-price">{{ formatPrice(article.prix) }}</span>
              <span class="article-category" *ngIf="article.categorie">{{ article.categorie }}</span>
            </div>
            <div class="article-stats">
              <span class="article-views">üëÅ {{ article.nombreVues }} vues</span>
              <span class="article-status" [class]="'status-' + article.statut.toLowerCase()">
                {{ article.statut === 'ACTIF' ? '‚úÖ Actif' : article.statut === 'VENDU' ? 'üí∞ Vendu' : '‚è∏ Expir√©' }}
              </span>
            </div>
            <div class="article-date">
              Publi√© le {{ article.publieLe | date:'dd/MM/yyyy' }}
            </div>
          </div>
          <div class="article-actions">
            <button class="btn btn-small btn-edit" (click)="editArticle(article)">‚úèÔ∏è Modifier</button>
            <button class="btn btn-small btn-delete" (click)="deleteArticle(article)">üóëÔ∏è Supprimer</button>
          </div>
        </div>
 
        <!-- Pagination -->
        <div *ngIf="totalPages > 1" class="pagination">
          <button
            class="page-btn"
            [disabled]="currentPage === 1"
            (click)="previousPage()"
          >
            ‚Äπ Pr√©c√©dent
          </button>
 
          <button
            *ngFor="let page of pageNumbers"
            class="page-btn"
            [class.active]="page === currentPage"
            (click)="goToPage(page)"
          >
            {{ page }}
          </button>
 
          <button
            class="page-btn"
            [disabled]="currentPage === totalPages"
            (click)="nextPage()"
          >
            Suivant ‚Ä∫
          </button>
        </div>
 
        <div class="pagination-info" *ngIf="filteredArticles.length > 0">
          <p>
            Affichage de {{ (currentPage - 1) * itemsPerPage + 1 }} √†
            {{ getMin(currentPage * itemsPerPage, filteredArticles.length) }}
            sur {{ filteredArticles.length }} articles
          </p>
        </div>
      </div>
    </div>
  </div>
</div>